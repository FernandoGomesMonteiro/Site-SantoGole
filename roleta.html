<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surpresa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/roleta.css">
    <link rel="stylesheet" href="css/acessibilidade_fontes.css">
    <link rel="stylesheet" href="css/acessibilidade_cores.css">
</head>

<body>
    <header class="main-header" id="main-header">
        <a href="index.html" class="logo">Santo<span>Gole</span></a>
        <nav class="desktop-nav">
            <a href="index.html">In√≠cio</a>
            <a href="/catalogo.html">Cat√°logo</a>
            <a href="/roleta.html" class="active">Surpresa</a>
            <a href="/sobre.html">Sobre</a>
        </nav>
        <div class="accessibility-widget" id="accessibility-widget" aria-label="Controles de acessibilidade">
            <button id="increase-text" aria-label="Aumentar tamanho do texto">A+</button>
            <button id="decrease-text" aria-label="Diminuir tamanho do texto">A‚àí</button>
            <button id="toggle-theme">üåô</button>
        </div>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h1>Roleta e Drinks Surpresa</h1>
            <p>Gire a roleta e descubra um drink aleat√≥rio ou explore nossa busca para encontrar sua receita perfeita!
            </p>
        </div>
    </section>

    <main>
        <div class="drinkAleatorio">
            <h1>Drink Aleat√≥rio</h1>
            <p>N√£o sabe o que pedir? Deixe a sorte escolher!</p>
            <div class="search-container">
                <button style="display: none;" class="search-btn" id="search-btn">
                    <i class="fas fa-search"></i> Buscar
                </button>

                <button class="random-btn" id="random-btn">
                    <i class="fas fa-random"></i> Surpreenda-me
                </button>

                <!-- Mensagens -->
                <div class="message" id="loading-message">
                    <i class="fas fa-cocktail"></i>
                    <p>Buscando drinks...</p>
                </div>

                <div class="message" id="error-message">
                    <i class="fas fa-exclamation-circle"></i>
                    <p>Nenhum drink encontrado. Tente outro termo.</p>
                </div>

                <!-- Resultados da Busca -->
                <div class="results-grid" id="results-grid">
                    <!-- Os resultados ser√£o inseridos aqui via JavaScript -->
                </div>
            </div>
        </div>

        <div class="roulette-wrapper">
            <h1>Monte sua Roleta de Drinks</h1>
            <p>Monte sua lista de drinks e gire para descobrir o escolhido.</p>
            <div class="roulette-content">
                <!-- Lista de drinks -->
                <div class="drink-list-wrapper">
                    <div class="add-drink">
                        <input type="text" id="drink-input" placeholder="Digite o nome do drink">
                        <button id="add-drink-btn">Adicionar</button>
                    </div>
                    <ul id="drink-list"></ul>
                </div>

                <!-- Canvas da roleta -->
                <div class="canvas-wrapper">
                    <canvas id="roulette" width="400" height="400"></canvas>
                    <button id="spin-btn">Girar a Roleta!</button>

                    <!-- Mensagem fixa do resultado -->
                    <div id="fixed-result">
                        <span id="fixed-result-text"></span>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Pop-up overlay -->
    <div id="overlay-result">
        <p id="overlay-text"></p>
    </div>

    <script>
        const canvas = document.getElementById('roulette');
        const ctx = canvas.getContext('2d');
        const drinkInput = document.getElementById('drink-input');
        const addDrinkBtn = document.getElementById('add-drink-btn');
        const drinkList = document.getElementById('drink-list');
        const spinBtn = document.getElementById('spin-btn');
        const fixedResult = document.getElementById('fixed-result');
        const fixedResultText = document.getElementById('fixed-result-text');

        let drinks = [];
        let colors = ["#FFB74D", "#FF8A65", "#FF7043", "#FFA726", "#FF6F00", "#FFCC80", "#FFE0B2"];
        let startAngle = 0;
        let arc = 0;
        let spinTimeout = null;
        let spinAngleStart = 0;
        let spinTime = 0;
        let spinTimeTotal = 0;

        // Adicionar drink
        addDrinkBtn.addEventListener('click', () => {
            addDrink();
        });

        // Permitir adicionar com Enter
        drinkInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addDrink();
            }
        });

        function addDrink() {
            const drinkName = drinkInput.value.trim();
            if (drinkName && !drinks.includes(drinkName)) {
                drinks.push(drinkName);
                createDrinkListItem(drinkName);
                drinkInput.value = '';
                drawRouletteWheel();
            }
        }

        // Criar item da lista com funcionalidades de edi√ß√£o e exclus√£o
        // Criar item da lista com funcionalidades de edi√ß√£o e exclus√£o
        function createDrinkListItem(drinkName) {
            const li = document.createElement('li');

            // Texto edit√°vel
            const drinkText = document.createElement('span');
            drinkText.className = 'drink-text';
            drinkText.textContent = drinkName;
            drinkText.setAttribute('contenteditable', 'true');

            // Bot√£o de exclus√£o
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';

            // Adicionar eventos
            drinkText.addEventListener('blur', (e) => {
                const newName = e.target.textContent.trim();
                const index = drinks.indexOf(drinkName);

                if (newName && newName !== drinkName) {
                    // Verificar se o nome j√° existe
                    if (drinks.includes(newName)) {
                        alert('Este drink j√° est√° na lista!');
                        e.target.textContent = drinkName;
                        return;
                    }

                    // Atualizar o drink na lista
                    drinks[index] = newName;
                    // Atualizar a vari√°vel drinkName para refletir a mudan√ßa
                    drinkName = newName;
                    drawRouletteWheel();
                } else if (!newName) {
                    // Se ficar vazio, restaurar o nome original
                    e.target.textContent = drinkName;
                }
            });

            drinkText.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.target.blur();
                }
            });

            deleteBtn.addEventListener('click', () => {
                const index = drinks.indexOf(drinkName);
                if (index !== -1) {
                    drinks.splice(index, 1);
                    li.remove();
                    drawRouletteWheel();

                    // Esconder a mensagem fixa se n√£o houver drinks
                    if (drinks.length === 0) {
                        fixedResult.classList.remove('show');
                    }
                }
            });

            li.appendChild(drinkText);
            li.appendChild(deleteBtn);
            drinkList.appendChild(li);
        }

        // Desenhar roleta
        function drawRouletteWheel() {
            if (drinks.length === 0) {
                ctx.clearRect(0, 0, 400, 400);
                return;
            }

            arc = 2 * Math.PI / drinks.length;
            const outsideRadius = 180;
            const textRadius = 130;
            const insideRadius = 50;

            ctx.clearRect(0, 0, 400, 400);

            for (let i = 0; i < drinks.length; i++) {
                const angle = startAngle + i * arc;
                ctx.fillStyle = colors[i % colors.length];
                ctx.beginPath();
                ctx.arc(200, 200, outsideRadius, angle, angle + arc, false);
                ctx.arc(200, 200, insideRadius, angle + arc, angle, true);
                ctx.fill();

                // Texto
                ctx.save();
                ctx.fillStyle = "#fff";
                ctx.translate(200 + Math.cos(angle + arc / 2) * textRadius,
                    200 + Math.sin(angle + arc / 2) * textRadius);
                ctx.rotate(angle + arc / 2 + Math.PI / 2);
                ctx.font = "16px Arial";
                ctx.textAlign = "center";
                ctx.fillText(drinks[i], 0, 0);
                ctx.restore();
            }

            // Indicador
            ctx.fillStyle = "#ff6f00";
            ctx.beginPath();
            ctx.moveTo(200 - 10, 200 - 180 - 5);
            ctx.lineTo(200 + 10, 200 - 180 - 5);
            ctx.lineTo(200, 200 - 180 + 15);
            ctx.fill();
        }

        function spin() {
            if (drinks.length === 0) {
                alert("Adicione pelo menos um drink!");
                return;
            }
            spinAngleStart = Math.random() * 10 + 10;
            spinTime = 0;
            spinTimeTotal = Math.random() * 3000 + 4000;
            rotateWheel();
        }

        function rotateWheel() {
            spinTime += 30;
            if (spinTime >= spinTimeTotal) {
                stopRotateWheel();
                return;
            }
            const spinAngle = spinAngleStart * (1 - spinTime / spinTimeTotal);
            startAngle += (spinAngle * Math.PI / 180);
            drawRouletteWheel();
            spinTimeout = setTimeout(rotateWheel, 30);
        }

        function stopRotateWheel() {
            clearTimeout(spinTimeout);
            const degrees = startAngle * 180 / Math.PI + 90;
            const arcd = arc * 180 / Math.PI;
            const index = Math.floor((360 - degrees % 360) / arcd);
            const drink = drinks[index];

            // Mostrar mensagem fixa
            fixedResultText.innerHTML = `üçπ O drink sorteado √©: <span class="drink-name">${drink}</span>!`;
            fixedResult.classList.add('show');

            // Mostrar pop-up (overlay)
            const overlay = document.getElementById('overlay-result');
            const overlayText = document.getElementById('overlay-text');
            overlayText.textContent = `üçπ O drink sorteado √©: ${drink}!`;
            overlay.classList.add('show');

            // Esconder pop-up depois de 3 segundos
            setTimeout(() => {
                overlay.classList.remove('show');
            }, 3000);
        }

        drawRouletteWheel();
        spinBtn.addEventListener('click', spin);
    </script>


    <script src="js/acess_cores.js"></script>
    <script src="js/acess_fontes.js"></script>
    <script src="js/menu.js"></script>
    <script src="js/footer.js"></script>
    <script src="js/busca.js"></script>
</body>

</html>